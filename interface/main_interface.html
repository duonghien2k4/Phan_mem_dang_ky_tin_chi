<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng k√Ω t√≠n ch·ªâ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="trang_chu.css">
    <script defer src="script.js"></script>
</head>

<body>
    <div class="all">
        <div class="sidebar">
            <img src="https://phenikaa-uni.edu.vn:3600/pu/vi/modules/logo-white_20210219042705.png" alt="Phenikaa Logo"
                class="sidebar-logo" width="150">
            <a onclick="showSection('home-info')"><i class="fas fa-home"></i> Trang ch·ªß</a>
            <a onclick="showSection('student-info')"><i class="fas fa-user-graduate"></i> Th√¥ng tin h·ªçc sinh</a>
            <a onclick="showSection('course-list')"><i class="fas fa-book"></i> Danh s√°ch m√¥n h·ªçc</a>
            <a onclick="showSection('teacher-list')"><i class="fas fa-chalkboard-teacher"></i> Gi√°o vi√™n</a>
            <a onclick="showSection('schedule')"><i class="fas fa-calendar-alt"></i> Th·ªùi kh√≥a bi·ªÉu</a>
            <a onclick="showSection('registration')"><i class="fas fa-edit"></i> ƒêƒÉng k√Ω h·ªçc</a>
            <button class="logout-button" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</button>
        </div>
        <div class="content">
            <div id="home-info" class="home-info" style="display: none;">
                <!-- Hero Section -->
                <section class="hero">
                    <div class="hero-container">
                        <img src="../img/san_truong.jpg" alt="M√¥ t·∫£ ·∫£nh" class="hero-image">
                        <div class="hero-text">
                            <h1>H·ªá th·ªëng ƒëƒÉng k√Ω t√≠n ch·ªâ</h1>
                            <p>Qu·∫£n l√Ω vi·ªác ƒëƒÉng k√Ω m√¥n h·ªçc m·ªôt c√°ch d·ªÖ d√†ng v√† thu·∫≠n ti·ªán.</p>
                            <a href="#" class="btn">B·∫Øt ƒë·∫ßu ngay</a>
                        </div>
                    </div>
                </section>

                <!-- Th√¥ng tin ng∆∞·ªùi d√πng -->
                <div class="welcome-section">
                    <h2>Ch√†o m·ª´ng, <span id="user-email"></span></h2>
                    <p>H·ªá th·ªëng gi√∫p sinh vi√™n d·ªÖ d√†ng ƒëƒÉng k√Ω c√°c m√¥n h·ªçc, xem l·ªãch h·ªçc v√† th√¥ng tin c√° nh√¢n.</p>
                    <p>Vui l√≤ng ch·ªçn c√°c m·ª•c trong thanh b√™n ƒë·ªÉ thao t√°c.</p>
                </div>

                <!-- M√¥n h·ªçc m·ªõi nh·∫•t -->
                <section class="latest-courses">
                    <h2>M√¥n h·ªçc m·ªõi nh·∫•t. <a href="#">Xem ngay.</a></h2>

                    <!-- N√∫t chuy·ªÉn ƒë·ªïi -->
                    <button id="prev-btn" class="slider-btn left">&lt;</button>
                    <button id="next-btn" class="slider-btn right">&gt;</button>

                    <!-- Danh s√°ch kh√≥a h·ªçc -->
                    <div class="course-container">
                        <div class="course-list">
                            <div class="course-card"><img src="math.jpg" alt="To√°n cao c·∫•p">
                                <h3>To√°n cao c·∫•p</h3>
                                <p>Gi·∫£i quy·∫øt c√°c b√†i to√°n ph·ª©c t·∫°p.</p>
                                <p class="credits">S·ªë t√≠n ch·ªâ: 3</p>
                            </div>
                            <div class="course-card"><img src="cs.jpg" alt="L·∫≠p tr√¨nh C++">
                                <h3>L·∫≠p tr√¨nh C++</h3>
                                <p>H·ªçc l·∫≠p tr√¨nh h∆∞·ªõng ƒë·ªëi t∆∞·ª£ng.</p>
                                <p class="credits">S·ªë t√≠n ch·ªâ: 4</p>
                            </div>
                            <div class="course-card dark-theme"><img src="ai.jpg" alt="Tr√≠ tu·ªá nh√¢n t·∫°o">
                                <h3>Tr√≠ tu·ªá nh√¢n t·∫°o</h3>
                                <p><span class="highlight">Kh√≥a h·ªçc ƒë·∫∑c bi·ªát</span></p>
                                <p class="credits">S·ªë t√≠n ch·ªâ: 5</p>
                            </div>
                            <div class="course-card"><img src="db.jpg" alt="C∆° s·ªü d·ªØ li·ªáu">
                                <h3>C∆° s·ªü d·ªØ li·ªáu</h3>
                                <p>Qu·∫£n l√Ω d·ªØ li·ªáu chuy√™n s√¢u.</p>
                                <p class="credits">S·ªë t√≠n ch·ªâ: 3</p>
                            </div>
                            <div class="course-card"><img src="network.jpg" alt="M·∫°ng m√°y t√≠nh">
                                <h3>M·∫°ng m√°y t√≠nh</h3>
                                <p>T√¨m hi·ªÉu v·ªÅ h·ªá th·ªëng m·∫°ng.</p>
                                <p class="credits">S·ªë t√≠n ch·ªâ: 3</p>
                            </div>
                            <div class="course-card dark-theme"><img src="ml.jpg" alt="Machine Learning">
                                <h3>Machine Learning</h3>
                                <p>·ª®ng d·ª•ng AI v√†o th·ª±c t·∫ø.</p>
                                <p class="credits">S·ªë t√≠n ch·ªâ: 4</p>
                            </div>
                            <div class="course-card dark-theme"><img src="ml.jpg" alt="Machine Learning">
                                <h3>Machine Learning</h3>
                                <p>·ª®ng d·ª•ng AI v√†o th·ª±c t·∫ø.</p>
                                <p class="credits">S·ªë t√≠n ch·ªâ: 4</p>
                            </div>
                            <div class="course-card dark-theme"><img src="ml.jpg" alt="Machine Learning">
                                <h3>Machine Learning</h3>
                                <p>·ª®ng d·ª•ng AI v√†o th·ª±c t·∫ø.</p>
                                <p class="credits">S·ªë t√≠n ch·ªâ: 4</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Features Section -->
                <section class="features">
                    <div class="feature">
                        <h2>Ch·ªçn kh√≥a h·ªçc d·ªÖ d√†ng</h2>
                        <p>T√¨m ki·∫øm v√† ƒëƒÉng k√Ω l·ªõp h·ªçc theo s·ªü th√≠ch.</p>
                    </div>
                    <div class="feature">
                        <h2>Qu·∫£n l√Ω th·ªùi kh√≥a bi·ªÉu</h2>
                        <p>Xem l·ªãch h·ªçc chi ti·∫øt v√† tr√°nh tr√πng l·∫∑p.</p>
                    </div>
                    <div class="feature">
                        <h2>H·ªó tr·ª£ 24/7</h2>
                        <p>Li√™n h·ªá b·ªô ph·∫≠n h·ªó tr·ª£ n·∫øu g·∫∑p v·∫•n ƒë·ªÅ.</p>
                    </div>
                </section>
            </div>


            <div id="registration" class="registration">
                <h2>ƒêƒÉng k√Ω h·ªçc</h2>
                <div id="course-container" class="course-container"></div>
                <div id="class-container" class="class-container"></div>
                <h3>L·ªõp ƒë√£ ƒëƒÉng k√Ω:</h3>
                <ul id="registered-classes"></ul>
            </div>

            <div id="student-info" class="student-info" style="display: none;">
                <div class="student-info-container">
                    <img id="student-avatar" src="default-avatar.png" alt="·∫¢nh ƒë·∫°i di·ªán" class="avatar">
                    <div class="student-info-content">
                        <div class="student-info-title">TH√îNG TIN C∆† B·∫¢N</div>
                        <div class="student-info-grid">
                            <p><strong>M√£ SV:</strong> <input type="text" id="student-id" disabled></p>
                            <p><strong>H·ªç v√† ƒë·ªám:</strong> <input type="text" id="student-lastname" disabled></p>
                            <p><strong>Ng√†y sinh:</strong> <input type="date" id="student-dob" disabled></p>
                            <p><strong>T√™n:</strong> <input type="text" id="student-firstname" disabled></p>
                            <p><strong>Kh√≥a ƒë√†o t·∫°o:</strong> <input type="text" id="student-course" disabled></p>
                            <p><strong>L·ªõp:</strong> <input type="text" id="student-class" disabled></p>
                            <p><strong>Ni√™n kh√≥a:</strong> <input type="text" id="student-year" disabled></p>
                            <p><strong>Khoa qu·∫£n l√Ω:</strong> <input type="text" id="student-faculty" disabled></p>
                            <p><strong>Email:</strong> <input type="email" id="student-email" disabled></p>
                            <p><strong>Ng√†nh:</strong> <input type="text" id="student-major" disabled></p>
                            <p><strong>Gi·ªõi t√≠nh:</strong>
                                <select id="student-gender" disabled>
                                    <option value="Nam">Nam</option>
                                    <option value="N·ªØ">N·ªØ</option>
                                    <option value="Kh√°c">Kh√°c</option>
                                </select>
                            </p>
                            <p><strong>H·ªá ƒë√†o t·∫°o:</strong> <input type="text" id="student-system" disabled></p>
                            <p><strong>Tr·∫°ng th√°i:</strong> <input type="text" id="student-status" disabled></p>
                            <p><strong>Ch·ª©c v·ª•:</strong> <input type="text" id="student-role" disabled></p>
                            <p><strong>Ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o:</strong> <input type="text" id="student-program" disabled>
                            </p>
                        </div>
                        <button id="edit-info-btn" onclick="enableEdit()">C·∫≠p nh·∫≠t th√¥ng tin</button>
                        <button id="save-info-btn" onclick="saveStudentInfo()" style="display: none;">L∆∞u th√¥ng
                            tin</button>

                    </div>
                </div>
                <div class="footer">
                    Copyright ¬© 2025. Phenikaa University. All rights reserved.<br>
                    Developed by PHX Smart School<br>
                    Ph√≤ng C√¥ng t√°c sinh vi√™n - ƒê·ªãa ch·ªâ: T·∫ßng 3, T√≤a nh√† A9, Tr∆∞·ªùng ƒê·∫°i h·ªçc Phenikaa, Nguy·ªÖn Tr√°c, H√†
                    ƒê√¥ng,
                    H√† N·ªôi<br>
                    ‚òéÔ∏è 0246.2918.118 (m√°y l·∫ª 138) | üí¨ <a href="#">Nh·∫Øn tin</a> | üìß <a
                        href="mailto:ctsv@phenikaa-uni.edu.vn">ctsv@phenikaa-uni.edu.vn</a>
                </div>
            </div>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, child, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDla-CSFtR6-y2vscJjuX6Q0vp0x0TTLT4",
            authDomain: "dangkytinchi-73b7a.firebaseapp.com",
            projectId: "dangkytinchi-73b7a",
            storageBucket: "dangkytinchi-73b7a.appspot.com",
            databaseURL: "https://dangkytinchi-73b7a-default-rtdb.firebaseio.com",
            messagingSenderId: "1013393708459",
            appId: "1:1013393708459:web:21be9269a148ed83386eee"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const auth = getAuth();

        let currentUserEmail = "";
        let currentUserId = "";

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUserEmail = user.email;
                currentUserId = user.email.split('@')[0];
                document.getElementById("user-email").textContent = currentUserEmail;

                loadStudentInfo();
                loadCourses();
                loadRegisteredClasses();
            } else {
                window.location.href = "login.html";
            }
        });
        function loadCourses() {
            const courseContainer = document.getElementById("course-container");
            courseContainer.innerHTML = "";

            // Danh s√°ch m√¥n h·ªçc & l·ªãch c·ªë ƒë·ªãnh
            const courses = [
                { id: "LTW", name: "L·∫≠p tr√¨nh Web", times: [{ day: "Th·ª© 2", time: "6h45-9h25" }, { day: "Th·ª© 5", time: "9h30-12h10" }] },
                { id: "LTC", name: "L·∫≠p tr√¨nh C", times: [{ day: "Th·ª© 3", time: "9h30-12h10" }] },
                { id: "LTCpp", name: "L·∫≠p tr√¨nh C++", times: [{ day: "Th·ª© 2", time: "13h-15h40" }, { day: "Th·ª© 6", time: "15h45-18h25" }] },
                { id: "CTDL", name: "C·∫•u tr√∫c d·ªØ li·ªáu", times: [{ day: "Th·ª© 4", time: "6h45-9h25" }] },
                { id: "HDH", name: "H·ªá ƒëi·ªÅu h√†nh", times: [{ day: "Th·ª© 3", time: "13h-15h40" }, { day: "Th·ª© 5", time: "6h45-9h25" }] },
                { id: "CSDL", name: "C∆° s·ªü d·ªØ li·ªáu", times: [{ day: "Th·ª© 2", time: "9h30-12h10" }] },
                { id: "THVP", name: "Tin h·ªçc vƒÉn ph√≤ng", times: [{ day: "Th·ª© 4", time: "13h-15h40" }, { day: "Th·ª© 6", time: "9h30-12h10" }] },
                { id: "AI", name: "Tr√≠ tu·ªá nh√¢n t·∫°o", times: [{ day: "Th·ª© 5", time: "15h45-18h25" }] },
                { id: "DPT", name: "ƒê·ªì h·ªça m√°y t√≠nh", times: [{ day: "Th·ª© 3", time: "6h45-9h25" }, { day: "Th·ª© 6", time: "13h-15h40" }] },
                { id: "TTNT", name: "X·ª≠ l√Ω ng√¥n ng·ªØ t·ª± nhi√™n", times: [{ day: "Th·ª© 4", time: "9h30-12h10" }] }
            ];

            courses.forEach(course => {
                const courseBox = document.createElement("div");
                courseBox.className = "course-box";
                courseBox.textContent = course.name;
                courseBox.onclick = () => showClasses(course);
                courseContainer.appendChild(courseBox);
            });
        }

        function showClasses(course) {
            const classContainer = document.getElementById("class-container");
            classContainer.innerHTML = "";

            const courseData = {
                "LTW": { teachers: ["Nguy·ªÖn VƒÉn A", "Tr·∫ßn Th·ªã B"], rooms: ["P101", "P102"] },
                "LTC": { teachers: ["Ph·∫°m VƒÉn C"], rooms: ["P201"] },
                "LTCpp": { teachers: ["Nguy·ªÖn VƒÉn E", "Tr·∫ßn VƒÉn F"], rooms: ["P301", "P302"] },
                "CTDL": { teachers: ["L√™ Th·ªã G"], rooms: ["P401"] },
                "HDH": { teachers: ["Ph·∫°m VƒÉn I", "Nguy·ªÖn VƒÉn J"], rooms: ["P501", "P502"] },
                "CSDL": { teachers: ["Tr·∫ßn Minh K"], rooms: ["P601"] },
                "THVP": { teachers: ["Nguy·ªÖn Th·ªã M", "Ph·∫°m VƒÉn N"], rooms: ["P701", "P702"] },
                "AI": { teachers: ["L√™ Th·ªã O"], rooms: ["P801"] },
                "DPT": { teachers: ["Tr·∫ßn Minh Q", "Nguy·ªÖn VƒÉn R"], rooms: ["P901", "P902"] },
                "TTNT": { teachers: ["L√™ Th·ªã S"], rooms: ["P1001"] }
            };

            let classData = courseData[course.id];
            if (!classData) return;

            course.times.forEach((timeSlot, index) => {
                let classId = `${course.id}-N0${index + 1}`;
                let teacher = classData.teachers[index % classData.teachers.length];
                let room = classData.rooms[index % classData.rooms.length];

                const classBox = document.createElement("div");
                classBox.className = "class-box";
                classBox.innerHTML = `<strong>${timeSlot.day} - ${timeSlot.time}</strong><br>Gi√°o vi√™n: ${teacher}<br>Ph√≤ng: ${room}`;
                classBox.onclick = () => registerClass(classId, timeSlot, teacher, room);
                classContainer.appendChild(classBox);
            });
        }

        function registerClass(classId, timeSlot, teacher, room) {
            const userRef = ref(db, `students/${currentUserId}/registeredClasses/${classId}`);
            set(userRef, { day: timeSlot.day, time: timeSlot.time, teacher, room }).then(() => {
                alert(`ƒêƒÉng k√Ω th√†nh c√¥ng l·ªõp ${classId}`);
                loadRegisteredClasses();
            });
        }

        function unregisterClass(classId) {
            const userRef = ref(db, `students/${currentUserId}/registeredClasses/${classId}`);
            remove(userRef).then(() => {
                alert(`ƒê√£ h·ªßy ƒëƒÉng k√Ω l·ªõp ${classId}`);
                loadRegisteredClasses(); // C·∫≠p nh·∫≠t l·∫°i danh s√°ch ƒë√£ ƒëƒÉng k√Ω
            });
        }

        function loadRegisteredClasses() {
            const registeredList = document.getElementById("registered-classes");
            registeredList.innerHTML = "";

            get(ref(db, `students/${currentUserId}/registeredClasses`)).then((snapshot) => {
                if (snapshot.exists()) {
                    const classes = snapshot.val();
                    Object.keys(classes).forEach(classId => {
                        const li = document.createElement("li");
                        li.textContent = classId;
                        const removeBtn = document.createElement("button");
                        removeBtn.textContent = "H·ªßy";
                        removeBtn.onclick = () => unregisterClass(classId);
                        li.appendChild(removeBtn);
                        registeredList.appendChild(li);
                    });
                }
            });
        }
        window.onload = loadCourses;
        function logout() {
            signOut(auth).then(() => {
                window.location.href = "login.html";
            });
        }
    </script>
</body>

</html>